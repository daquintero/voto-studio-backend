language: python
python:
- 3.6
services:
- postgresql
- elasticsearch
addons:
  postgresql: '10'
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
env:
- DJANGO=2.1.5 PGPORT=5433
before_install:
- sudo sed -i -e '/local.*peer/s/postgres/all/' -e 's/peer\|md5/trust/g' /etc/postgresql/*/main/pg_hba.conf
- sudo service postgresql restart
- sleep 1
- export DJANGO_SETTINGS_MODULE=config.settings.travis
- export PYTHONPATH=$HOME/builds/voto_backend/voto_backend
- PIP_USE_MIRRORS=true
install:
- pip install -r requirements/travis.txt
- pip install django==$DJANGO --quiet
- pip install psycopg2 --quiet
before_script:
- psql -c "CREATE DATABASE travisci;" -U postgres
- psql -c "CREATE SCHEMA main_site;" -U postgres
- sleep 10
script:
- python manage.py migrate_both
- pytest -s -v
deploy:
  provider: heroku
  api_key:
    secure: "nOzxjqS3Fdr6gWSeYIy4LZhZ1SAhDZ4pBONvVbe8QITnaMOUi8v+eulaRj5OI3z6eMGMrPOA5nGWEbeCpQqUggoGZvRk1N81r2NvZY/Lx5p5/7OaMQl/YxewrVrBsoLQ5qO3jpHN1l1a2DXkyXWPG+nZDIgebY9sUvk4R9YaJclOjDjrFUozpUAYPbtouKGTX39XiGUSOEL2e9OhVvbpJWgvYOhTDrdphA2HKeMZDq73jd4d/41TDQ4N0jC15o4JOfjYPDfKFb7rjAjRtzwBF65o8utLwsHA1tQuR8FUCud42pdI3UHsRdCWk+fVylWaakiddsSysbz3HTOheAVsvFhSQXDQzRjUNeyw/eTb7Kp/pvJ59YIrTrtWsYxvhHQ4+yBTV5qtVeRUOOjlhimkSjnB419dlA3hkC9IqzaJk5UySV0R9zgVxAiSUWdHYXwd82t5BQAwbejxAKVUHwL0Km7N5ttvA1cxf0VvAET0Mf+4FS12Yp9lfbwakSM8eYzy5VWGUzUbBY6a8+R8Ghf0biGXJWxBmfUnEo13jit837hUybj0iyemqfk+/Ajeh1PbBVB3bhswLQGVL/QNX+r4v8r51rD8elLOx1cWLIVJ/X3545qS6oQXvywnFVtjNvAobi0HgU+seG6d+C0/Jt1Et3m8D2aZ7eDAyC96ncJi1Xw="
  app: v-development
